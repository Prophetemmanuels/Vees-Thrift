<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vees Thrift</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">

<!-- EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
(function(){emailjs.init("lS0EqS1UcioO4Cm1B");})();
</script>

<style>
:root{--pink:#f6c1d9;--gold:#d4af37;--white:#ffffff;}
body{margin:0;font-family:Segoe UI,sans-serif;background:linear-gradient(to bottom,var(--pink),var(--white));}
header{display:flex;align-items:center;justify-content:space-between;padding:10px;background:white;box-shadow:0 2px 6px rgba(0,0,0,.1);}
header img{width:50px;height:50px;border-radius:50%;border:2px solid var(--gold);}
header h2{margin-left:10px}
#datetime{font-size:14px;color:#555;}
.search{padding:10px;}
.search input{width:100%;padding:10px;border-radius:20px;border:1px solid #ccc;}
.products{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:15px;padding:15px;}
.product{background:white;border-radius:15px;padding:10px;box-shadow:0 2px 6px rgba(0,0,0,.1);text-align:center;cursor:pointer;transition:.2s;}
.product:hover{transform:scale(1.02);}
.product img{width:100%;border-radius:10px;}
.price{color:var(--gold);font-weight:bold;}
.cart{position:fixed;bottom:0;width:100%;background:white;padding:10px;box-shadow:0 -2px 6px rgba(0,0,0,.1);display:flex;justify-content:space-between;align-items:center;z-index:5;}
.cart button{background:var(--pink);padding:8px 14px;border:none;border-radius:20px;cursor:pointer;}
.whatsapp{position:fixed;right:15px;bottom:90px;background:#25D366;color:white;padding:15px;border-radius:50%;text-decoration:none;font-size:20px;z-index:5;}
.whatsapp-group{position:fixed;right:15px;bottom:150px;background:#128C7E;color:white;padding:15px;border-radius:50%;text-decoration:none;font-size:20px;z-index:5;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:10;padding:15px;overflow:auto;}
.modal img{width:100%;border-radius:10px;}
.back{margin-bottom:10px;}
#cartModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:15;padding:15px;overflow:auto;}
.cart-item{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid #ddd;}
.cart-item button{background:red;color:white;padding:3px 6px;border-radius:5px;cursor:pointer;border:none;}
#purchaseLog{background:white;margin:15px;padding:10px;border-radius:10px;max-height:200px;overflow:auto;}
#purchaseLog h3{font-size:16px;margin-bottom:8px;}
.purchase-item{font-size:13px;border-bottom:1px solid #ddd;padding:5px 0;}
#customerInfo{display:none;background:white;margin:0;padding:20px;border-radius:15px 15px 0 0;box-shadow:0 -2px 6px rgba(0,0,0,.2);max-height:50%;overflow:auto;position:fixed;bottom:-300px;left:0;width:100%;transition:bottom 0.5s ease-in-out;}
#customerInfo input{width:100%;padding:8px;margin:5px 0;border-radius:5px;border:1px solid #ccc;}
#customerInfo button{width:100%;margin-top:10px;padding:10px;border:none;border-radius:20px;background:var(--pink);cursor:pointer;}
</style>
</head>

<body>

<header>
 <div style="display:flex; align-items:center;">
  <img src="images/icon.png">
  <h2>Vees Thrift</h2>
 </div>
 <div id="datetime"></div>
</header>

<div class="search">
 <input id="search" placeholder="Search available items...">
</div>

<div class="products">
 <!-- PRODUCT SLOTS -->
 <div class="product" onclick="openProduct('Pink Dress','images/p1.jpg',250)">
  <img src="images/p1.jpg"><h4>Pink Dress</h4><p class="price">ZMW 250</p>
 </div>
 <div class="product" onclick="openProduct('Gold Handbag','images/p2.jpg',300)">
  <img src="images/p2.jpg"><h4>Gold Handbag</h4><p class="price">ZMW 300</p>
 </div>
 <div class="product" onclick="openProduct('White Sneakers','images/p3.jpg',280)">
  <img src="images/p3.jpg"><h4>White Sneakers</h4><p class="price">ZMW 280</p>
 </div>
 <!-- add more products as needed -->
</div>

<div class="cart">
 <span>Total: ZMW <b id="total">0</b></span>
 <button onclick="openCartModal()">View Cart</button>
 <button onclick="checkout()">Pay Now</button>
</div>

<a class="whatsapp" href="https://wa.me/260971415665">ðŸ’¬</a>
<a class="whatsapp-group" href="https://chat.whatsapp.com/LIZLsg7FucSCfNq1HH02pF" target="_blank">ðŸ‘¥</a>

<!-- Full View Modal -->
<div class="modal" id="modal">
 <button class="back" onclick="closeModal()">â¬… Back</button>
 <img id="modalImg"><h3 id="modalName"></h3><p id="modalPrice"></p>
 <button onclick="addToCart()">Add to Cart</button>
</div>

<!-- Cart Modal -->
<div class="modal" id="cartModal">
 <button class="back" onclick="closeCartModal()">â¬… Back</button>
 <h3>Cart Items</h3>
 <div id="cartItems"></div>
</div>

<!-- Customer Info -->
<div id="customerInfo">
 <h3>Customer Info</h3>
 <label>WhatsApp Number:</label><br>
 <input type="text" id="customerWhatsApp" placeholder="e.g. 0971xxxxxx"><br>
 <label>Email (Optional):</label><br>
 <input type="email" id="customerEmail" placeholder="your@email.com"><br>
 <button onclick="confirmCustomerInfo()">Submit</button>
</div>

<!-- Purchase Log -->
<div id="purchaseLog">
 <h3>Purchase Records</h3>
 <div id="purchaseList"></div>
</div>

<script>
let cart=[], total=0, current={};
let purchases=JSON.parse(localStorage.getItem("purchases"))||[];
const modal=document.getElementById("modal");
const cartModal=document.getElementById("cartModal");
const cartItemsDiv=document.getElementById("cartItems");
const purchaseList=document.getElementById("purchaseList");
const customerInfoDiv=document.getElementById("customerInfo");

function openProduct(name,img,price){current={name,price};modal.style.display="block";modalImg.src=img;modalName.innerText=name;modalPrice.innerText="ZMW "+price;}
function closeModal(){modal.style.display="none";}
function openCartModal(){cartModal.style.display="block";renderCart();}
function closeCartModal(){cartModal.style.display="none";}
function addToCart(){cart.push(current);total+=current.price;document.getElementById("total").innerText=total;closeModal();alert(current.name+" added to cart!");renderCart();}
function removeFromCart(i){total-=cart[i].price;cart.splice(i,1);document.getElementById("total").innerText=total;renderCart();}
function renderCart(){cartItemsDiv.innerHTML="";if(cart.length===0){cartItemsDiv.innerHTML="<p>Your cart is empty.</p>";return;}cart.forEach((item,i)=>{const div=document.createElement("div");div.className="cart-item";div.innerHTML=`${item.name} - ZMW ${item.price} <button onclick="removeFromCart(${i})">Remove</button>`;cartItemsDiv.appendChild(div);});}

function checkout(){if(cart.length===0){alert("Cart empty!");return;}customerInfoDiv.style.display="block";setTimeout(()=>{customerInfoDiv.style.bottom="0";},50);}
function confirmCustomerInfo(){
 let customerWA=document.getElementById("customerWhatsApp").value;
 let customerEmail=document.getElementById("customerEmail").value;
 if(!customerWA){alert("WhatsApp number required!");return;}
 let totalAmount=total;
 if(!confirm(`Your total amount is ZMW ${totalAmount}.\nClick OK to dial *115# to make payment.`)) return;

 // Dial USSD
 window.location.href="tel:*115#";

 setTimeout(()=>{
   if(confirm("Have you completed payment? Click OK to send your order via WhatsApp.")){
     let msg="Vees Thrift Order:%0A";
     let now=new Date();
     cart.forEach(i=>{
       msg+=`${i.name} - ZMW ${i.price} on ${now.toLocaleDateString()} at ${now.toLocaleTimeString()}%0A`;
       purchases.unshift({product:i.name,price:i.price,date:now.toLocaleDateString(),time:now.toLocaleTimeString(),customerWA,customerEmail});
     });
     msg+=`Total: ZMW ${totalAmount}`;
     localStorage.setItem("purchases",JSON.stringify(purchases));
     renderPurchases();
     cart=[];total=0;document.getElementById("total").innerText=0;
     cartModal.style.display="none";customerInfoDiv.style.bottom="-300px";customerInfoDiv.style.display="none";

     // WhatsApp order
     window.open(`https://wa.me/260971415665?text=${msg}`);

     // Email appreciation
     if(customerEmail){
       emailjs.send("service_59an2yo","template_yje59gi",{
         to_email:customerEmail,
         to_whatsapp:customerWA,
         message:"Thank you for shopping with Vees Thrift! We appreciate your purchase."
       }).then(res=>console.log("Email sent",res.status),err=>console.log("Email failed",err));
     }
     alert("Thank you! Your order has been sent.");
   }
 },500);
}

function renderPurchases(){purchaseList.innerHTML="";purchases.forEach(p=>{const div=document.createElement("div");div.className="purchase-item";div.innerHTML=`${p.product} - ZMW ${p.price}<br><small>${p.date} at ${p.time}</small>`;purchaseList.appendChild(div);});}
renderPurchases();

search.addEventListener("input",e=>{let v=e.target.value.toLowerCase();document.querySelectorAll(".product").forEach(p=>{p.style.display=p.innerText.toLowerCase().includes(v)?"block":"none";});});
function updateTime(){let now=new Date();document.getElementById("datetime").innerText=now.toLocaleDateString()+" | "+now.toLocaleTimeString();}
setInterval(updateTime,1000);updateTime();

if("serviceWorker" in navigator){navigator.serviceWorker.register("service-worker.js").then(()=>console.log("SW Registered"));}
</script>

</body>
</html>
