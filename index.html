<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vees Thrift</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script> (function(){emailjs.init("YOUR_PUBLIC_KEY");})(); </script>

<style>
:root{
  --pink:#f6c1d9;
  --gold:#d4af37;
  --white:#ffffff;
}

body{
  margin:0;
  font-family:Segoe UI,sans-serif;
  background:linear-gradient(to bottom,var(--pink),var(--white));
}

/* Header */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px;
  background:white;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}
header img{width:50px;height:50px;border-radius:50%;border:2px solid var(--gold);}
header h2{margin-left:10px;}
#datetime{font-size:14px;color:#555;}

/* Search */
.search{padding:10px;}
.search input{width:100%;padding:10px;border-radius:20px;border:1px solid #ccc;}

/* Products */
.products{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:15px;padding:15px;}
.product{
  background:white;
  border-radius:15px;
  padding:10px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
  text-align:center;
  cursor:pointer;
  transition:.2s;
}
.product:hover{transform:scale(1.02);}
.product img{width:100%;border-radius:10px;}
.price{color:var(--gold);font-weight:bold;}

/* Cart bar */
.cart{
  position:fixed;
  bottom:0;
  width:100%;
  background:white;
  padding:10px;
  box-shadow:0 -2px 6px rgba(0,0,0,.1);
  display:flex;
  justify-content:space-between;
  align-items:center;
  z-index:5;
}
.cart button{background:var(--pink);padding:8px 14px;border:none;border-radius:20px;cursor:pointer;}

/* WhatsApp buttons */
.whatsapp{position:fixed;right:15px;bottom:90px;background:#25D366;color:white;padding:15px;border-radius:50%;text-decoration:none;font-size:20px;z-index:5;}
.whatsapp-group{position:fixed;right:15px;bottom:150px;background:#128C7E;color:white;padding:15px;border-radius:50%;text-decoration:none;font-size:20px;z-index:5;}

/* Modal */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:10;padding:15px;overflow:auto;}
.modal img{width:100%;border-radius:10px;}
.back{margin-bottom:10px;}

/* Cart Modal */
#cartModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:white;z-index:15;padding:15px;overflow:auto;}
.cart-item{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid #ddd;}
.cart-item button{background:red;color:white;padding:3px 6px;border-radius:5px;cursor:pointer;border:none;}

/* Purchase Log */
#purchaseLog{background:white;margin:15px;padding:10px;border-radius:10px;max-height:200px;overflow:auto;}
#purchaseLog h3{font-size:16px;margin-bottom:8px;}
.purchase-item{font-size:13px;border-bottom:1px solid #ddd;padding:5px 0;}

/* Customer Info Modal - Centered */
#customerInfo{
  display:none;
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%, -50%);
  width:90%;
  max-width:400px;
  max-height:80vh;
  background:white;
  padding:20px;
  border-radius:20px;
  box-shadow:0 4px 15px rgba(0,0,0,.3);
  overflow-y:auto;
  z-index:20;
  opacity:0;
  transition:opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
  flex-direction:column;
}
#customerInfo.show{opacity:1;}
body.modal-open{overflow:hidden;}
#customerInfo label{margin-top:10px;font-weight:600;font-size:14px;}
#customerInfo input{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ccc;}
#customerInfo button{width:100%;padding:12px;margin-top:10px;border:none;border-radius:25px;background:var(--pink);font-size:16px;cursor:pointer;}
#customerInfo .closeBtn{background:red;color:white;margin-top:10px;}
#receiptCanvas{display:none;}
</style>
</head>

<body>

<header>
 <div style="display:flex; align-items:center;">
  <img src="images/logo.png">
  <h2>Vees Thrift</h2>
 </div>
 <div id="datetime"></div>
</header>

<div class="search">
 <input id="search" placeholder="Search available items...">
</div>

<div class="products">
 <div class="product" onclick="openProduct('Pink Checkered Dress','images/p1.jpg',135)">
  <img src="images/p1.jpg"><h4>SOLD</h4><p class="price">ZMW 135</p>
 </div>
 <div class="product" onclick="openProduct('Pink Sleeveless Jumpsuit','images/p2.jpg',45)">
  <img src="images/p2.jpg"><h4>Pink Sleeveless Jumpsuit</h4><p class="price">ZMW 45</p>
 </div>
 <div class="product" onclick="openProduct('Blue Floral Dress','images/p3.jpg',45)">
  <img src="images/p3.jpg"><h4>Blue Floral Dress</h4><p class="price">ZMW 45</p>
</div>
<div class="product" onclick="openProduct('Red Checkered Dress','images/p4.jpg',45)">
  <img src="images/p4.jpg"><h4>Red Checkered Dress</h4><p class="price">ZMW 45</p>
 </div>
 <div class="product" onclick="openProduct('Red Checkered Dress','images/p5.jpg',55)">
  <img src="images/p5.jpg"><h4>Red Checkered Dress</h4><p class="price">ZMW 55</p>
 </div>
 <div class="product" onclick="openProduct('Black and Floral Dress','images/p6.jpg',45)">
  <img src="images/p6.jpg"><h4>Black and Floral Dress</h4><p class="price">ZMW 45</p>
</div>
<div class="product" onclick="openProduct('Black Pocker dot Dress','images/p7.jpg',55)">
  <img src="images/p7.jpg"><h4>Black Pocker dot Dress</h4><p class="price">ZMW 55</p>
 </div>
 <div class="product" onclick="openProduct('Floral Blue Off-Shoulder Dress','images/p8.jpg',45)">
  <img src="images/p8.jpg"><h4>Floral Blue Off-Shoulder Dress</h4><p class="price">ZMW 45</p>
</div>
<div class="product" onclick="openProduct('Dark Floral Long-Sleeve Dress','images/p9.jpg',55)">
  <img src="images/p9.jpg"><h4>Dark Floral Long-Sleeve Dress</h4><p class="price">ZMW 55</p>
 </div>
 <div class="product" onclick="openProduct('Light Blue Sleeveless Dress','images/p10.jpg',135)">
  <img src="images/p10.jpg"><h4>Light Blue Sleeveless Dress</h4><p class="price">ZMW 135</p>
</div>
<div class="product" onclick="openProduct('Light Blue Party Dress','images/p11.jpg',35)">
  <img src="images/p11.jpg"><h4>Light Blue Party Dress</h4><p class="price">ZMW 35</p>
 </div>
<div class="product" onclick="openProduct('Light-Colored Printed Dress','images/p12.jpg',300)">
  <img src="images/p12.jpg"><h4>Light-Colored Printed Dress</h4><p class="price">ZMW 300</p>
 </div>
<div class="product" onclick="openProduct('Red Floral Dress','images/p13.jpg',300)">
  <img src="images/p13.jpg"><h4>Red Floral Dress</h4><p class="price">ZMW 45</p>
 </div>

<div class="cart">
 <span>Total: ZMW <b id="total">0</b></span>
 <button onclick="openCartModal()">View Cart</button>
 <button onclick="openCustomerInfo()">Pay Now</button>
</div>

<a class="whatsapp" href="https://wa.me/260971415665">ðŸ’¬</a>
<a class="whatsapp-group" href="https://chat.whatsapp.com/LIZLsg7FucSCfNq1HH02pF" target="_blank">ðŸ‘¥</a>

<!-- Product Modal -->
<div class="modal" id="modal">
 <button class="back" onclick="closeModal()">â¬… Back</button>
 <img id="modalImg"><h3 id="modalName"></h3><p id="modalPrice"></p>
 <button onclick="addToCart()">Add to Cart</button>
</div>

<!-- Cart Modal -->
<div class="modal" id="cartModal">
 <button class="back" onclick="closeCartModal()">â¬… Back</button>
 <h3>Cart Items</h3>
 <div id="cartItems"></div>
</div>

<!-- Customer Info Modal -->
<div id="customerInfo">
 <h3>Customer Info</h3>
 <label>Name:</label><input type="text" id="customerName" placeholder="Full Name">
 <label>WhatsApp Number:</label><input type="text" id="customerWhatsApp" placeholder="0971xxxxxx">
 <label>Email (Optional):</label><input type="email" id="customerEmail" placeholder="your@email.com">
 <button onclick="sendOrder()">Send Order</button>
 <button onclick="makeTransaction()">Make Transaction</button>
 <button class="closeBtn" onclick="closeCustomerInfo()">Close</button>
</div>

<!-- Purchase Log -->
<div id="purchaseLog">
 <button onclick="clearPurchases()" style="margin-bottom:10px;background:red;color:white;border:none;padding:5px 10px;border-radius:5px;">Clear Purchase Records</button>
 <h3>Purchase Records</h3>
 <div id="purchaseList"></div>
</div>

<canvas id="receiptCanvas"></canvas>

<script>
// VARIABLES
let cart=[], total=0, current={};
let purchases = JSON.parse(localStorage.getItem("purchases")) || [];
const modal=document.getElementById("modal");
const cartModal=document.getElementById("cartModal");
const cartItemsDiv=document.getElementById("cartItems");
const purchaseList=document.getElementById("purchaseList");
const customerInfoDiv=document.getElementById("customerInfo");

// MODALS
function openProduct(name,img,price){
  current={name,price};
  modal.style.display="block";
  document.getElementById("modalImg").src=img;
  document.getElementById("modalName").innerText=name;
  document.getElementById("modalPrice").innerText="ZMW "+price;
}
function closeModal(){modal.style.display="none";}
function openCartModal(){cartModal.style.display="block";renderCart();}
function closeCartModal(){cartModal.style.display="none";}
function openCustomerInfo(){
  customerInfoDiv.style.display="flex";
  document.body.classList.add("modal-open");
  setTimeout(()=>{customerInfoDiv.classList.add("show");},10);
}
function closeCustomerInfo(){
  customerInfoDiv.classList.remove("show");
  document.body.classList.remove("modal-open");
  setTimeout(()=>{customerInfoDiv.style.display="none";},400);
}

// CART FUNCTIONS
function addToCart(){cart.push(current);total+=current.price;document.getElementById("total").innerText=total;closeModal();alert(current.name+" added to cart!");renderCart();}
function removeFromCart(i){total-=cart[i].price;cart.splice(i,1);document.getElementById("total").innerText=total;renderCart();}
function renderCart(){cartItemsDiv.innerHTML="";if(cart.length===0){cartItemsDiv.innerHTML="<p>Your cart is empty.</p>";return;}cart.forEach((item,i)=>{const div=document.createElement("div");div.className="cart-item";div.innerHTML=`${item.name} - ZMW ${item.price} <button onclick="removeFromCart(${i})">Remove</button>`;cartItemsDiv.appendChild(div);});}

// SEND ORDER
function sendOrder(){
  const name=document.getElementById("customerName").value;
  const whatsapp=document.getElementById("customerWhatsApp").value;
  const email=document.getElementById("customerEmail").value;
  if(!name || !whatsapp){alert("Name and WhatsApp number required!");return;}
  let msg=`Vees Thrift Order from ${name} (WA:${whatsapp}):%0A`;
  let now=new Date();
  cart.forEach(i=>{
    msg+=`${i.name} - ZMW ${i.price}%0A`;
    purchases.unshift({product:i.name,price:i.price,date:now.toLocaleDateString(),time:now.toLocaleTimeString(),name,whatsapp,email});
  });
  msg+=`Total: ZMW ${total}`;
  localStorage.setItem("purchases",JSON.stringify(purchases));
  renderPurchases();
  alert("Your order has been sent to WhatsApp.");
  window.open(`https://wa.me/260971415665?text=${msg}`);
  window.open(`https://wa.me/260760528887?text=${msg}`);
  generateReceipt(name,whatsapp,email);
}

// MAKE TRANSACTION
function makeTransaction(){
  const number = prompt("Copy number to transfer: Vivien 0971415665 / Emmanuel agent 20202857");
  if(!number) return;
  const ussd="*115#";
  if(/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)){
    window.location.href=`tel:${ussd}`;
    alert("USSD dialer opened. Complete your payment.");
  } else { alert("Use a phone to make the mobile transaction."); }
}

// PURCHASES
function renderPurchases(){purchaseList.innerHTML="";purchases.forEach(p=>{const div=document.createElement("div");div.className="purchase-item";div.innerHTML=`${p.product} - ZMW ${p.price}<br><small>${p.date} at ${p.time}</small>`;purchaseList.appendChild(div);});}
function clearPurchases(){if(confirm("Clear all purchase records?")){purchases=[];localStorage.setItem("purchases","[]");renderPurchases();}}

// RECEIPT
function generateReceipt(name,whatsapp,email){
  const canvas=document.getElementById("receiptCanvas");
  canvas.width=500;canvas.height=500;
  const ctx=canvas.getContext("2d");
  ctx.fillStyle="#fff";ctx.fillRect(0,0,500,500);
  ctx.fillStyle="#000";ctx.font="16px Arial";ctx.fillText("Vees Thrift Receipt",150,30);
  ctx.font="14px Arial";ctx.fillText(`Customer: ${name}`,20,60);
  ctx.fillText(`WhatsApp: ${whatsapp}`,20,80);
  if(email)ctx.fillText(`Email: ${email}`,20,100);
  let y=130;
  cart.forEach(i=>{ctx.fillText(`${i.name} - ZMW ${i.price}`,20,y);y+=20;});
  ctx.fillText(`Total: ZMW ${total}`,20,y+10);
  ctx.fillText(`Date: ${new Date().toLocaleString()}`,20,y+30);
  const link=document.createElement("a");link.download="receipt.png";link.href=canvas.toDataURL("image/png");link.click();
  cart=[];total=0;document.getElementById("total").innerText=0;closeCustomerInfo();renderCart();
}

// SEARCH
document.getElementById("search").addEventListener("input",e=>{
  let v=e.target.value.toLowerCase();
  document.querySelectorAll(".product").forEach(p=>{
    p.style.display=p.innerText.toLowerCase().includes(v)?"block":"none";
  });
});

// LIVE TIME
function updateTime(){let now=new Date();document.getElementById("datetime").innerText=now.toLocaleDateString()+" | "+now.toLocaleTimeString();}
setInterval(updateTime,1000);updateTime();

// SERVICE WORKER
if("serviceWorker" in navigator){navigator.serviceWorker.register("service-worker.js").then(()=>console.log("SW Registered"));}

// ADD TO HOME SCREEN
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  const addBtn = document.createElement('button');
  addBtn.innerText = "Add Vees Thrift to Home Screen";
  addBtn.style = "position:fixed;bottom:100px;right:15px;padding:10px 15px;background:var(--pink);border:none;border-radius:10px;color:white;z-index:30;cursor:pointer;";
  document.body.appendChild(addBtn);

  addBtn.addEventListener('click', async () => {
    addBtn.style.display = 'none';
    deferredPrompt.prompt();
    const choiceResult = await deferredPrompt.userChoice;
    deferredPrompt = null;
  });
});
</script>

</body>
</html>
